# Collaborative Component User Tracking

## Overview
Components generated by the GenerativeUIService are designed to be collaborative - multiple project members can interact with the same component, and their individual actions will be properly attributed to them.

## Key Principle
The `authUser` variable in generated components always represents the **current viewer/user**, not the component creator. This enables true collaborative functionality.

## How It Works

### 1. Dynamic User Context
- When any user loads a component, the `ReactComponentRenderer` injects their current authentication data
- The `authUser` variable is populated with the current viewer's information
- This happens regardless of who originally created the component

### 2. User Attribution in CRUD Operations
All generated components use this pattern:
```jsx
// Current viewer's identity (dynamic per user)
const currentUser = authUser || { id: 1, name: 'Anonymous', email: 'user@example.com' };

// Create operations
const createItem = (data) => {
  const item = {
    ...data,
    creator: currentUser,        // Who created this item
    created_by: currentUser.id,  // User ID for tracking
    created_at: new Date().toISOString()
  };
  // ... save logic
};

// Update operations  
const updateItem = (id, changes) => {
  const updatedItem = {
    ...existingItem,
    ...changes,
    updated_by: currentUser.id,     // Who made this change
    last_editor: currentUser,       // Full user object
    updated_at: new Date().toISOString()
  };
  // ... save logic
};

// Delete operations
const deleteItem = (id) => {
  const deletionRecord = {
    id: id,
    deleted_by: currentUser.id,     // Who deleted it
    deleted_by_user: currentUser,   // Full user object
    deleted_at: new Date().toISOString()
  };
  // ... deletion logic
};
```

### 3. Data Flow
1. User A creates a component → saved to database
2. User B loads the same component → gets their own `authUser` data
3. User B creates/updates data → actions attributed to User B
4. User A reloads component → sees User B's changes with correct attribution

## Implementation Details

### Backend (GenerativeUIService)
- Prompts emphasize using `authUser` for current user context
- No static user data is embedded in component code
- Components are generated to be user-agnostic

### Frontend (ReactComponentRenderer)
- Injects current session's auth data as `authUser` prop
- Falls back to Inertia shared auth data if needed
- Never uses embedded/static auth data

### Component Rendering (CustomView)
- Always passes current user's auth data to ReactComponentRenderer
- Uses `usePage()` fallback for robust auth data access

## Benefits
1. **True Collaboration**: Multiple users can work with the same component
2. **Proper Attribution**: All actions are tracked to the correct user
3. **Security**: Users can't impersonate other users
4. **Audit Trail**: Complete history of who did what and when

## Example Scenario
1. Project Manager creates a "Team Chat" component
2. Developer opens the same component → sees their own name as current user
3. Developer sends a message → message attributed to Developer, not Project Manager
4. Designer opens component → sees both messages with correct attribution
5. Designer deletes a message → deletion tracked to Designer

This ensures that shared components work naturally for all project members while maintaining proper user tracking and accountability.