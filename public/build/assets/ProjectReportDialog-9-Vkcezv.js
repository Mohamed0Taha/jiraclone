import{j as e}from"./index-BgEJ3fxA.js";import{r as l}from"./ProjectReportDialog-DJSS4N_t.js";import{A as I}from"./AutoAwesome-C8YBcAsX.js";import{c as W}from"./createSvgIcon-BJOZcqxU.js";import{D as F,a as _}from"./DialogContent-DSMMXfBC.js";import{D as z}from"./DialogTitle-CslrqFxR.js";import{L as U}from"./LinearProgress-DS1Mq4qD.js";import{S as T}from"./Stack-8UQV77y9.js";import{C as m}from"./Chip-21CA6oxg.js";import{A as E}from"./Alert-AqF1eoq9.js";import{D as V}from"./Divider-Mh942rqT.js";import{B as X}from"./Box-DwDErR6p.js";import{T as R}from"./Typography-D7k_4FBJ.js";import{D as B}from"./DialogActions-tu8p45QK.js";import{B as f}from"./Button-awGqnw0r.js";import{a}from"./createTheme-C_kE-Qd2.js";import"./DefaultPropsProvider-Bua-nAaA.js";import"./useSlot-CiX-lWvG.js";import"./Paper-PFfIOqkm.js";import"./Fade-DhaX7TN9.js";import"./getReactElementRef-F5A8c8Er.js";import"./index-CaqUbZRR.js";import"./Modal-DIrGbC0Y.js";import"./ownerWindow-XbzhRCTS.js";import"./Portal-DfkSyL9i.js";import"./index-Cvm9KgRT.js";import"./useThemeProps-BWPYVe8w.js";import"./ButtonBase-Cf3WRSsW.js";import"./isFocusVisible-B8k4qzLc.js";import"./IconButton-MFFsjt5V.js";import"./CircularProgress-RchlJGKc.js";import"./dividerClasses-C37mlFxW.js";const N=W(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v1.25c0 .41-.34.75-.75.75s-.75-.34-.75-.75V8c0-.55.45-1 1-1H10c.83 0 1.5.67 1.5 1.5zm5 2c0 .83-.67 1.5-1.5 1.5h-2c-.28 0-.5-.22-.5-.5v-5c0-.28.22-.5.5-.5h2c.83 0 1.5.67 1.5 1.5zm4-3.75c0 .41-.34.75-.75.75H19v1h.75c.41 0 .75.34.75.75s-.34.75-.75.75H19v1.25c0 .41-.34.75-.75.75s-.75-.34-.75-.75V8c0-.55.45-1 1-1h1.25c.41 0 .75.34.75.75M9 9.5h1v-1H9zM3 6c-.55 0-1 .45-1 1v13c0 1.1.9 2 2 2h13c.55 0 1-.45 1-1s-.45-1-1-1H5c-.55 0-1-.45-1-1V7c0-.55-.45-1-1-1m11 5.5h1v-3h-1z"})),O=W(e.jsx("path",{d:"M17.65 6.35c-1.63-1.63-3.94-2.57-6.48-2.31-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20c3.19 0 5.93-1.87 7.21-4.56.32-.67-.16-1.44-.9-1.44-.37 0-.72.2-.88.53-1.13 2.43-3.84 3.97-6.8 3.31-2.22-.49-4.01-2.3-4.48-4.52C5.31 9.44 8.26 6 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71z"}));function L(){const n="XSRF-TOKEN=",i=document.cookie?document.cookie.split("; "):[];for(const s of i)if(s.startsWith(n))return decodeURIComponent(s.substring(n.length));return null}function G(n=16){const i=new Uint8Array(n);return window.crypto.getRandomValues(i),Array.from(i,s=>s.toString(16).padStart(2,"0")).join("")}function De({open:n,onClose:i,project:s,tasks:u}){const o={todo:u?.todo?.length||0,inprogress:u?.inprogress?.length||0,review:u?.review?.length||0,done:u?.done?.length||0},d=o.todo+o.inprogress+o.review+o.done,k=d===0?0:Math.round((o.done||0)/d*100),[p,j]=l.useState(!1),[S,b]=l.useState(null),[$,w]=l.useState(null),[D,h]=l.useState(null),r=l.useRef(null);l.useEffect(()=>(n&&(j(!1),b(null),w(null),h(null)),()=>{r.current&&(r.current.abort(),r.current=null)}),[n]);const A=async()=>{if(!s?.id||p)return;if(r.current){try{r.current.abort()}catch{}r.current=null}j(!0),h(null),b(null),w(null);const t=new AbortController;r.current=t;const M=setTimeout(()=>{try{t.abort()}catch{}},9e4);try{const c=L();if(!c)throw new Error("Missing XSRF-TOKEN cookie. Make sure this route is on the 'web' middleware and you are logged in.");const y=G(),P=`${route("projects.report.generate",s.id)}?force=1&nonce=${y}&t=${Date.now()}`,x=await fetch(P,{method:"POST",credentials:"same-origin",cache:"no-store",signal:t.signal,headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-XSRF-TOKEN":c,"Cache-Control":"no-store, no-cache, must-revalidate",Pragma:"no-cache"},body:JSON.stringify({force:!0,nonce:y,totals:{...o,total:d,pct:k},generated_at:new Date().toISOString()})});if(!x.ok){let C="";try{const v=await x.json();C=typeof v?.message=="string"?` — ${v.message}`:""}catch{}throw new Error(`HTTP ${x.status}${C}`)}const g=await x.json(),H=g.download_url!=null?`${g.download_url}${g.download_url.includes("?")?"&":"?"}t=${Date.now()}&nonce=${y}`:null;b(H),w(g.summary??"")}catch(c){c?.name==="AbortError"?h("The report generation took too long and was canceled. Please try again."):h(c?.message||"Failed to generate report.")}finally{clearTimeout(M),j(!1),r.current===t&&(r.current=null)}};return e.jsxs(F,{open:n,onClose:i,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(z,{sx:{fontWeight:800},children:["Project Report — ",s?.name]}),e.jsxs(_,{dividers:!0,sx:{position:"relative",pb:2.5},children:[p&&e.jsx(U,{sx:{position:"absolute",left:0,top:0,width:"100%",borderTopLeftRadius:12,borderTopRightRadius:12}}),e.jsxs(T,{spacing:1.2,sx:{mb:1.5},children:[e.jsxs(T,{direction:"row",spacing:1,flexWrap:"wrap",rowGap:1,children:[e.jsx(m,{label:`${d} Tasks`,icon:e.jsx(I,{}),sx:{fontWeight:700,bgcolor:t=>a(t.palette.primary.main,.08),border:t=>`1px solid ${a(t.palette.primary.main,.25)}`}}),e.jsx(m,{label:`${k}% Complete`,sx:{fontWeight:700,bgcolor:t=>a(t.palette.success.main,.12),border:t=>`1px solid ${a(t.palette.success.main,.35)}`}}),e.jsx(m,{label:`To-do: ${o.todo}`,sx:{bgcolor:a("#64748B",.08)}}),e.jsx(m,{label:`In-progress: ${o.inprogress}`,sx:{bgcolor:a("#3B82F6",.08)}}),e.jsx(m,{label:`Review: ${o.review}`,sx:{bgcolor:a("#A855F7",.08)}}),e.jsx(m,{label:`Done: ${o.done}`,sx:{bgcolor:a("#22C55E",.1)}})]}),d===0&&e.jsx(E,{severity:"info",children:"No tasks yet. The AI report will still summarise project meta, but adding a few tasks makes it richer."})]}),e.jsx(V,{sx:{my:1.5}}),$?e.jsxs(X,{sx:{mt:1},children:[e.jsx(R,{variant:"subtitle2",sx:{fontWeight:800,mb:.5},children:"Executive summary"}),e.jsx(R,{variant:"body2",sx:{whiteSpace:"pre-line"},children:$})]}):e.jsx(R,{variant:"body2",sx:{opacity:.75},children:"Generate an AI report that synthesizes project meta (type, domain, team size, dates) and task progress into a concise PDF you can share with stakeholders."}),D&&e.jsx(E,{sx:{mt:1.5},severity:"error",children:D})]}),e.jsxs(B,{sx:{px:2.5,py:2},children:[e.jsx(f,{onClick:i,children:"Close"}),S?e.jsxs(T,{direction:"row",spacing:1,children:[e.jsx(f,{component:"a",href:S,target:"_blank",rel:"noopener",variant:"outlined",startIcon:e.jsx(N,{}),sx:{textTransform:"none",fontWeight:700},children:"View PDF"}),e.jsx(f,{onClick:A,startIcon:e.jsx(O,{}),variant:"text",disabled:p,sx:{textTransform:"none",fontWeight:600},children:"Regenerate"})]}):e.jsx(f,{onClick:A,disabled:p,variant:"contained",startIcon:e.jsx(I,{}),sx:{textTransform:"none",fontWeight:800,px:2.2},children:p?"Generating…":"Generate AI Report"})]})]})}export{De as default};
