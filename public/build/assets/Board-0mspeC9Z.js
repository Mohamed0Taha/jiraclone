import{j as t}from"./index-BgEJ3fxA.js";import{r as n}from"./ProjectReportDialog-DJSS4N_t.js";import{a as xt,u as gt,H as ft,r as k}from"./app-K9NsoLMf.js";import{A as bt}from"./AuthenticatedLayout-BoAa4njZ.js";import{c as A}from"./createSvgIcon-BJOZcqxU.js";import{C as vt}from"./SmartToyRounded-abUb5QI1.js";import{C as he}from"./CalendarMonthRounded-D2pw7wm1.js";import{P as jt}from"./PersonRounded-B2o1VDpb.js";import{K as St,P as yt,D as Ct,C as wt}from"./Column-B1Fl0rSS.js";import{P as At}from"./PublicRounded-CacxeP0d.js";import{F as Le}from"./FlagRounded-B2nmnq5y.js";import{S as Et}from"./Search-1b5ORwE8.js";import{S as kt,H as It}from"./HeaderBanner-BnQ-21p_.js";import Mt from"./UpgradeDialog-DSEZda76.js";import{u as Ge}from"./useSubscription-CqvGu-da.js";import{B as N}from"./Box-DwDErR6p.js";import{S as w}from"./Stack-8UQV77y9.js";import{Z as xe,F as ee}from"./Zoom-BNwHJd89.js";import{T as L}from"./Tooltip-B2fzUN7_.js";import{A as Tt}from"./Add-BSB6z5ab.js";import{C as Ft}from"./Close-CE36E4Lb.js";import{DEFAULT_METHOD as zt,getStatusMeta as Dt,getStatusOrder as Re,METHODOLOGIES as a}from"./meta-C4UEajO-.js";import Ot from"./TaskCard-B__87G8g.js";import Lt from"./MembersManagerDialog-meiUeR-M.js";import Rt from"./ProjectReportDialog-9-Vkcezv.js";import _t from"./ProjectDetailsDialog-DjBPciwj.js";import Bt from"./AssistantChat-Cuh1lkzR.js";import{T as I,I as Pt,S as Wt}from"./TextField-BZLKsJ9m.js";import{M as p}from"./MenuItem-CFfd6fkg.js";import{C as q}from"./Chip-21CA6oxg.js";import{I as _e}from"./InputAdornment-BMgQdgnP.js";import{I as ge}from"./IconButton-MFFsjt5V.js";import{a as Ht}from"./FormControl-9Ne_wXge.js";import{B as O}from"./Button-awGqnw0r.js";import{D as Be,a as Pe}from"./DialogContent-DSMMXfBC.js";import{D as We}from"./DialogTitle-CslrqFxR.js";import{T as H}from"./Typography-D7k_4FBJ.js";import{D as He}from"./DialogActions-tu8p45QK.js";import{a as u}from"./createTheme-C_kE-Qd2.js";import"./transition-BoHI2LEi.js";import"./CookieConsent-DEMz9Qt1.js";import"./Slide-BpTZt6Xy.js";import"./getReactElementRef-F5A8c8Er.js";import"./index-CaqUbZRR.js";import"./debounce-Be36O1Ab.js";import"./ownerWindow-XbzhRCTS.js";import"./Card-f4gJA82V.js";import"./DefaultPropsProvider-Bua-nAaA.js";import"./Paper-PFfIOqkm.js";import"./Link-Cm4ksNIx.js";import"./isFocusVisible-B8k4qzLc.js";import"./GroupsRounded-1FKM2HnB.js";import"./CheckCircleRounded-CybLc3-8.js";import"./ProCluster-BTdypetp.js";import"./WorkspacePremiumRounded-BEMuXXNC.js";import"./useSlot-CiX-lWvG.js";import"./ButtonBase-Cf3WRSsW.js";import"./useThemeProps-BWPYVe8w.js";import"./index-Cvm9KgRT.js";import"./useControlled-LNSG5UB_.js";import"./Grow---KOMtVK.js";import"./Portal-DfkSyL9i.js";import"./useSlotProps-5DvMlV7h.js";import"./CircularProgress-RchlJGKc.js";import"./DialogContentText-CicDk0in.js";import"./Fade-DhaX7TN9.js";import"./Modal-DIrGbC0Y.js";import"./RateReviewRounded-_pe94eyW.js";import"./RocketLaunchRounded-BHoF4EK3.js";import"./Edit-KFQoxZFW.js";import"./Delete-hxgZVV99.js";import"./Visibility-DofpzXGt.js";import"./ImageModal-D8IPxvIn.js";import"./CardContent-Bdo1cAqR.js";import"./Person-CwYP7FD8.js";import"./Alert-AqF1eoq9.js";import"./Divider-Mh942rqT.js";import"./dividerClasses-C37mlFxW.js";import"./List-D9XOj4nK.js";import"./ListItem-U-GawdQ1.js";import"./isMuiElement-BEUJm6md.js";import"./Avatar-B0qmhRz_.js";import"./Email-lTpUEqYc.js";import"./Settings-BkChhv5Z.js";import"./Group-v2Nq1Fc-.js";import"./Security-CZEkmB0V.js";import"./listItemTextClasses-DfQra0jB.js";import"./AutoAwesome-C8YBcAsX.js";import"./LinearProgress-DS1Mq4qD.js";import"./Key-B9enTFzV.js";const Nt=A(t.jsx("path",{d:"M4 11.5v4c0 .83.67 1.5 1.5 1.5S7 16.33 7 15.5v-4c0-.83-.67-1.5-1.5-1.5S4 10.67 4 11.5m6 0v4c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5M3.5 22h16c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5h-16c-.83 0-1.5.67-1.5 1.5S2.67 22 3.5 22M16 11.5v4c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5M10.57 1.49l-7.9 4.16c-.41.21-.67.64-.67 1.1C2 7.44 2.56 8 3.25 8h16.51C20.44 8 21 7.44 21 6.75c0-.46-.26-.89-.67-1.1l-7.9-4.16c-.58-.31-1.28-.31-1.86 0"})),Ut=A(t.jsx("path",{d:"M17 11V5c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h5c.55 0 1-.45 1-1v-3h2v3c0 .55.45 1 1 1h5c1.1 0 2-.9 2-2v-6c0-1.1-.9-2-2-2zM7 19H5v-2h2zm0-4H5v-2h2zm0-4H5V9h2zm4 4H9v-2h2zm0-4H9V9h2zm0-4H9V5h2zm4 8h-2v-2h2zm0-4h-2V9h2zm0-4h-2V5h2zm4 12h-2v-2h2zm0-4h-2v-2h2z"})),$t=A(t.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),Vt=A(t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"})),Gt=A(t.jsx("path",{d:"M16 10.53c-.29-.29-.77-.29-1.06 0l-4.35 4.35L9 13.29c-.29-.29-.77-.29-1.06 0s-.29.77 0 1.06l1.94 1.94c.39.39 1.02.39 1.41 0l4.7-4.7c.3-.29.3-.77.01-1.06M19 3h-1V2c0-.55-.45-1-1-1s-1 .45-1 1v1H8V2c0-.55-.45-1-1-1s-1 .45-1 1v1H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-1 16H6c-.55 0-1-.45-1-1V8h14v10c0 .55-.45 1-1 1"})),qt=A(t.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"})),Jt=A(t.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"})),Qt=A(t.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V18c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05.02.01.03.03.04.04 1.14.83 1.93 1.94 1.93 3.41V18c0 .35-.07.69-.18 1H22c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5"})),Yt=A(t.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),Kt=A(t.jsx("path",{d:"M2.73 21h18.53c.77 0 1.25-.83.87-1.5l-9.27-16c-.39-.67-1.35-.67-1.73 0l-9.27 16c-.38.67.1 1.5.87 1.5M13 18h-2v-2h2zm-1-4c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1"})),Zt=A(t.jsx("path",{d:"m19.41 7.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.42M14 13c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1h-1c0 .55-.45 1-1 1s-1-.45-1-1h-1c-.55 0-1-.45-1-1s.45-1 1-1h3v-1h-3c-.55 0-1-.45-1-1v-3c0-.55.45-1 1-1h1c0-.55.45-1 1-1s1 .45 1 1h1c.55 0 1 .45 1 1s-.45 1-1 1h-3v1zm0-5c-.55 0-1-.45-1-1V3.5L17.5 8z"}));function Xt({onAddTask:h,onOpenAssistant:r,methodStyles:E,assistantOpen:M,projectId:J}){const[g,R]=n.useState(!1),{shouldShowOverlay:oe}=Ge();oe("ai_chat");const re=()=>{R(!g)},se=()=>{R(!1),h()},ie=()=>{R(!1),r()},l=()=>{window.location.href=route("projects.export.jira",J)};return t.jsx(N,{sx:{position:"fixed",bottom:20,right:20,zIndex:1200},children:t.jsxs(w,{spacing:2,alignItems:"center",children:[t.jsx(xe,{in:g,timeout:200,style:{transitionDelay:g?"100ms":"0ms"},children:t.jsx(L,{title:"AI Assistant",placement:"left",children:t.jsx(ee,{size:"medium",onClick:ie,sx:{bgcolor:"secondary.main",color:"white",boxShadow:"0 8px 16px -8px rgba(0,0,0,.3)","&:hover":{bgcolor:"secondary.dark",transform:"scale(1.05)"},transition:"all 0.2s ease"},children:t.jsx(kt,{})})})}),t.jsx(xe,{in:g,timeout:200,style:{transitionDelay:"0ms"},children:t.jsx(L,{title:"Create task (c)",placement:"left",children:t.jsx(ee,{size:"medium",onClick:se,sx:{background:E.accent,color:"white",boxShadow:"0 8px 16px -8px rgba(0,0,0,.3)","&:hover":{opacity:.9,transform:"scale(1.05)"},transition:"all 0.2s ease"},children:t.jsx(Tt,{})})})}),t.jsx(xe,{in:g,timeout:200,style:{transitionDelay:g?"150ms":"0ms"},children:t.jsx(L,{title:"Export Jira CSV",placement:"left",children:t.jsx(ee,{size:"medium",onClick:l,sx:{bgcolor:"info.main",color:"white",boxShadow:"0 8px 16px -8px rgba(0,0,0,.3)","&:hover":{bgcolor:"info.dark",transform:"scale(1.05)"},transition:"all 0.2s ease"},children:t.jsx(Jt,{})})})}),t.jsx(L,{title:g?"Close menu":"Quick actions",children:t.jsx(ee,{color:"primary",onClick:re,sx:{background:g?"linear-gradient(45deg, #f44336 30%, #ff5722 90%)":`linear-gradient(45deg, ${E.accent} 30%, #1976d2 90%)`,boxShadow:"0 10px 20px -12px rgba(0,0,0,.4)","&:hover":{transform:"scale(1.05)",boxShadow:"0 12px 24px -10px rgba(0,0,0,.5)"},transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:g?"rotate(45deg)":"rotate(0deg)"},children:g?t.jsx(Ft,{}):t.jsx(Yt,{})})})]})})}const Ne={[a.KANBAN]:{accent:"#4F46E5",gradient:"linear-gradient(140deg,#F7FAFF 0%,#F2F6FE 55%,#EDF2FA 100%)",chipBg:h=>u("#4F46E5",.08),chipBorder:h=>u("#4F46E5",.18)},[a.SCRUM]:{accent:"#06B6D4",gradient:"linear-gradient(140deg,#F0FDFF 0%,#ECFEFF 55%,#E0F2FE 100%)",chipBg:h=>u("#06B6D4",.1),chipBorder:h=>u("#06B6D4",.2)},[a.AGILE]:{accent:"#10B981",gradient:"linear-gradient(140deg,#F0FDF4 0%,#ECFDF5 55%,#E7F5EE 100%)",chipBg:h=>u("#10B981",.1),chipBorder:h=>u("#10B981",.2)},[a.WATERFALL]:{accent:"#0EA5E9",gradient:"linear-gradient(140deg,#F0F9FF 0%,#E0F2FE 55%,#DBEAFE 100%)",chipBg:h=>u("#0EA5E9",.1),chipBorder:h=>u("#0EA5E9",.2)},[a.LEAN]:{accent:"#22C55E",gradient:"linear-gradient(140deg,#F0FDF4 0%,#ECFDF5 55%,#E8F5E9 100%)",chipBg:h=>u("#22C55E",.1),chipBorder:h=>u("#22C55E",.2)}},Ue=["todo","inprogress","review","done"],te={[a.KANBAN]:{todo:"todo",inprogress:"inprogress",review:"review",done:"done"},[a.SCRUM]:{backlog:"todo",todo:"todo",inprogress:"inprogress",testing:"review",review:"review",done:"done"},[a.AGILE]:{backlog:"todo",todo:"todo",inprogress:"inprogress",testing:"review",review:"review",done:"done"},[a.WATERFALL]:{requirements:"todo",design:"inprogress",implementation:"inprogress",verification:"review",maintenance:"done"},[a.LEAN]:{backlog:"todo",todo:"inprogress",testing:"review",review:"review",done:"done"}},$e={[a.KANBAN]:{todo:"todo",inprogress:"inprogress",review:"review",done:"done"},[a.SCRUM]:{todo:"todo",inprogress:"inprogress",review:"review",done:"done"},[a.AGILE]:{todo:"todo",inprogress:"inprogress",review:"review",done:"done"},[a.WATERFALL]:{todo:"requirements",inprogress:"design",review:"verification",done:"maintenance"},[a.LEAN]:{todo:"backlog",inprogress:"todo",review:"testing",done:"done"}},Ve=(h,r)=>`phaseMap:${h}:${r}`;function _r({auth:h,project:r={},tasks:E={},users:M=[],isPro:J}){const g=xt(),R=typeof J=="boolean"?J:!!(g?.props&&g.props.isPro),{shouldShowOverlay:oe,userPlan:re}=Ge(),se=oe("automation"),ie=(()=>{const e=Object.values(a),o=r?.meta?.methodology;if(e.includes(o))return o;let s=null;try{r?.id&&(s=localStorage.getItem(`project:${r.id}:methodology`))}catch{s=null}return e.includes(s)?s:zt})(),[l,qe]=n.useState(ie),Q=n.useMemo(()=>Dt(l),[l]),c=n.useMemo(()=>Re(l),[l]),m=Ne[l]||Ne[a.KANBAN],Je=320,Qe=12,[_,U]=n.useState({});n.useEffect(()=>{try{const e=localStorage.getItem(Ve(r?.id||"p",l));U(e?JSON.parse(e):{})}catch{U({})}},[r?.id,l]),n.useEffect(()=>{try{localStorage.setItem(Ve(r?.id||"p",l),JSON.stringify(_))}catch{}},[_,r?.id,l]),n.useEffect(()=>{try{const e={..._};let o=!1;const s=new Set;Ue.forEach(i=>{const b=Array.isArray(E?.[i])?E[i]:[],v=$e[l][i]||c[0]||"todo";b.forEach(x=>{s.add(x.id);const F=_?.[x.id];!!F&&c.includes(F)&&(te[l][F]||"todo")===i||e[x.id]!==v&&(e[x.id]=v,o=!0)})}),Object.keys(e).forEach(i=>{const b=Number(i);s.has(b)||(delete e[i],o=!0)}),o&&U(e)}catch{}},[E,l]);const[ne,z]=n.useState(!1),[j,fe]=n.useState(!1),[D,be]=n.useState(null),[Ye,Y]=n.useState(!1),[K,Z]=n.useState(null),[ve,ae]=n.useState(!1),[T,le]=n.useState(""),[B,je]=n.useState(""),[Ke,Se]=n.useState(!1),[ye,Ce]=n.useState(!1),[Ze,we]=n.useState(!1),[Xe,Ae]=n.useState(!1),[X,ce]=n.useState(!1),de=e=>{const o={};return c.forEach(s=>o[s]=[]),Ue.forEach(s=>{(Array.isArray(e?.[s])?e[s]:[]).forEach(b=>{const v=$e[l][s]||c[0]||"todo",x=_?.[b.id],W=!!x&&c.includes(x)&&(te[l][x]||"todo")===s?x:v;o[W].push({...b,status:W})})}),o},et=e=>Array.isArray(e)?!T&&!B?e:e.filter(o=>{if(!o)return!1;const s=!T||o.title&&o.title.toLowerCase().includes(T.toLowerCase())||o.description&&o.description.toLowerCase().includes(T.toLowerCase()),i=!B||o.priority===B;return s&&i}):[],[S,me]=n.useState(de(E)),P=n.useMemo(()=>{const e={};return Object.keys(S).forEach(o=>{e[o]=et(S[o]||[])}),e},[S,T,B]);n.useEffect(()=>{me(de(E))},[E,l,JSON.stringify(_)]);const Ee=n.useMemo(()=>{if(!K)return null;for(const e of c){const o=(S[e]||[]).find(s=>s.id===K);if(o)return o}return null},[K,S,c]),{data:C,setData:y,post:tt,patch:ot,reset:ke,processing:$,errors:f}=gt({title:"",description:"",start_date:"",end_date:"",assignee_id:"",status:c[0]||"todo",priority:"medium",milestone:!1}),pe=n.useMemo(()=>c.reduce((e,o)=>e+(Array.isArray(P[o])?P[o].length:0),0),[P,c]),Ie=c[c.length-1],rt=Array.isArray(P[Ie])?P[Ie].length:0,st=pe===0?0:Math.round(rt/pe*100),V=e=>{const o=e?.props?.tasks||E||{};me(de(o))},ue=(e=c[0])=>{ke(),fe(!1),be(null);const o=c.includes(e)?e:c[0];y("status",o),y("start_date",r?.start_date??""),z(!0)},it=e=>{fe(!0),be(e.id),y({title:e.title,description:e.description??"",start_date:e.start_date??"",end_date:e.end_date??"",assignee_id:e.assignee?.id??"",status:c.includes(e.status)?e.status:c[0],priority:e.priority??"medium",milestone:e.milestone??!1}),z(!0)},nt=e=>{try{const o={...r?.meta||{},methodology:e};k.patch(route("projects.update",r.id),{meta:o},{preserveScroll:!0,preserveState:!0,only:["project"],onSuccess:()=>{try{r.meta&&(r.meta.methodology=e)}catch{}}});try{r?.id&&e&&localStorage.setItem(`project:${r.id}:methodology`,e)}catch{}}catch(o){console.error("Failed to persist methodology",o)}},at=e=>{e.preventDefault(),z(!1);const o=j?route("tasks.update",[r.id,D]):route("tasks.store",r.id),s=te[l][C.status]||"todo",i={...C,status:s};(j?ot:tt)(o,i,{preserveScroll:!0,onSuccess:v=>{try{const x=j?D:v?.props?.task?.id;x&&U(F=>({...F,[x]:C.status}))}catch{}V(v),ke()},onError:()=>{}})},Me=e=>{Z(e),Y(!0)},lt=()=>{k.delete(route("tasks.destroy",[r.id,K]),{preserveScroll:!0,onSuccess:V}),Y(!1),Z(null)},ct=(e,o)=>{console.log("Uploading image for task:",e.id,"file:",o);const s=new FormData;s.append("image",o),k.post(route("tasks.attachments.store",[r.id,e.id]),s,{forceFormData:!0,preserveScroll:!0,onSuccess:i=>{console.log("Image upload successful:",i),V(i)},onError:i=>{console.error("Image upload failed:",i),alert("Image upload failed: "+(i.image?.[0]||"Unknown error"))}})},dt=e=>{const o=e.target.files?.[0];if(!o||!D)return;const s=new FormData;s.append("image",o),ae(!0),k.post(route("tasks.attachments.store",[r.id,D]),s,{forceFormData:!0,preserveScroll:!0,onSuccess:i=>{console.log("Form image upload successful"),V(i),ae(!1)},onError:i=>{console.error("Form image upload failed:",i),alert("Image upload failed: "+(i.image?.[0]||"Unknown error")),ae(!1)}})},mt=({destination:e,source:o,draggableId:s})=>{if(!e||e.droppableId===o.droppableId||!s)return;const i=Number(s),b=o.droppableId,v=e.droppableId,x=(S[b]||[]).find(G=>G.id===i);if(!x)return;const F=(S[b]||[]).filter(G=>G.id!==i),W=[...S[v]||[]],ut={...x,status:v};W.splice(e.index,0,ut),me({...S,[b]:F,[v]:W}),U(G=>({...G,[i]:v}));const ht=te[l][v]||"todo";k.patch(route("tasks.update",[r.id,i]),{status:ht},{preserveScroll:!0,onSuccess:V})},Te=n.useRef(null);n.useEffect(()=>{const e=o=>{const s=o.target,i=s?.tagName?.toLowerCase?.()||"",b=i==="input"||i==="textarea"||s?.isContentEditable===!0||!!s?.closest?.(".MuiTextField-root")||!!s?.closest?.('[role="textbox"]')||!!s?.closest?.('input, textarea, [contenteditable="true"]')||!!s?.closest?.("form");o.shiftKey&&String(o.key||"").toLowerCase()==="c"&&!ne&&!$&&!X&&!b&&ue(c[0])};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ne,$,c,X]);const Fe=e=>R?e(!0):we(!0),ze=e=>{if(!e)return null;try{const o=new Date(e);return Number.isNaN(o.getTime())?e:o.toLocaleDateString()}catch{return e}},d=r?.meta||{},De=[{icon:t.jsx(St,{fontSize:"small"}),label:r?.key,show:!!r?.key},{icon:t.jsx(Ut,{fontSize:"small"}),label:d.project_type,show:!!d.project_type},{icon:t.jsx(At,{fontSize:"small"}),label:d.domain,show:!!d.domain},{icon:t.jsx(yt,{fontSize:"small"}),label:d.location,show:!!d.location},{icon:t.jsx(Qt,{fontSize:"small"}),label:d.team_size?`${d.team_size} members`:"",show:!!d.team_size},{icon:t.jsx(Zt,{fontSize:"small"}),label:d.budget,show:!!d.budget},{icon:t.jsx(Nt,{fontSize:"small"}),label:d.primary_stakeholder,show:!!d.primary_stakeholder}].filter(e=>e.show),Oe={[a.KANBAN]:"Kanban",[a.SCRUM]:"Scrum",[a.AGILE]:"Agile",[a.WATERFALL]:"Waterfall",[a.LEAN]:"Lean"}[l];n.useEffect(()=>{try{r?.id&&l&&localStorage.setItem(`project:${r.id}:methodology`,l)}catch{}},[r?.id,l]);const pt=()=>r?t.jsx(N,{sx:{mb:1.25,borderRadius:2.5,p:1,background:"linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.75))",border:e=>`1px solid ${m.chipBorder(e)}`,boxShadow:"0 8px 22px -14px rgba(0,0,0,.25)"},children:t.jsxs(w,{spacing:.75,children:[t.jsxs(w,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(q,{label:`${Oe} Mode`,size:"small",sx:{height:22,fontWeight:700,background:e=>m.chipBg(e),border:e=>`1px solid ${m.chipBorder(e)}`,color:"#000000","& .MuiChip-label":{color:"#000000",fontWeight:700}},color:"primary"}),t.jsx(H,{variant:"subtitle1",sx:{fontWeight:800,letterSpacing:.1},children:r?.name||"Project"}),t.jsx(O,{size:"small",startIcon:t.jsx(Gt,{}),onClick:()=>{k.visit(`/projects/${r.id}/timeline`)},sx:{ml:1,textTransform:"none",fontWeight:700,borderRadius:2,px:1.25,py:.25,background:e=>u(e.palette.primary.main,.08),border:e=>`1px solid ${u(e.palette.primary.main,.22)}`,"&:hover":{background:e=>u(e.palette.primary.main,.14)}},children:"Timeline"})]}),De.length>0&&t.jsxs(w,{direction:"row",spacing:.75,flexWrap:"wrap",rowGap:.75,children:[De.map((e,o)=>t.jsx(q,{icon:e.icon,label:e.label,size:"small",sx:{bgcolor:s=>m.chipBg(s),border:s=>`1px solid ${m.chipBorder(s)}`,"& .MuiChip-label":{fontWeight:600},height:24}},o)),(r?.start_date||r?.end_date)&&t.jsx(q,{icon:t.jsx(he,{fontSize:"small"}),label:`${ze(r?.start_date)??"—"} → ${ze(r?.end_date)??"—"}`,size:"small",sx:{bgcolor:e=>m.chipBg(e),border:e=>`1px solid ${m.chipBorder(e)}`,"& .MuiChip-label":{fontWeight:600},height:24}})]}),(d.objectives||d.constraints)&&t.jsxs(w,{spacing:.5,children:[d.objectives&&t.jsxs(w,{direction:"row",spacing:.5,alignItems:"flex-start",children:[t.jsx(Le,{fontSize:"small",sx:{mt:"2px",color:u("#16A34A",.95)}}),t.jsx(L,{title:d.objectives,arrow:!0,placement:"top",children:t.jsx(H,{variant:"body2",sx:{overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:d.objectives})})]}),d.constraints&&t.jsxs(w,{direction:"row",spacing:.5,alignItems:"flex-start",children:[t.jsx(Kt,{fontSize:"small",sx:{mt:"2px",color:u("#F59E0B",.95)}}),t.jsx(L,{title:d.constraints,arrow:!0,placement:"top",children:t.jsx(H,{variant:"body2",sx:{overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:d.constraints})})]})]})]})}):null;return t.jsxs(t.Fragment,{children:[t.jsx(ft,{title:`${r?.name??"Project"} – Task Board`}),t.jsx(bt,{user:h?.user,children:t.jsxs(N,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",background:m.gradient,p:{xs:1.5,md:2}},style:{"--col-w":`${Je}px`,"--col-gap":`${Qe}px`},children:[t.jsx(It,{projectName:r?.name??"Project",totalTasks:pe,percentDone:st,usersCount:Array.isArray(M)?M.length:0,onAiTasks:()=>{k.visit(`/projects/${r.id}/tasks/ai`)},isPro:R,onOpenMembers:()=>Fe(Se),onOpenAutomations:()=>{if(se){k.visit(re?.billing_url||"/billing");return}k.visit(`/projects/${r.id}/automations`)},onOpenReport:()=>Fe(Ce),onOpenDetails:()=>Ae(!0),onOpenAssistant:()=>ce(!0)}),t.jsxs(w,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[t.jsxs(I,{select:!0,size:"small",label:"Methodology",value:l,onChange:e=>{const o=e.target.value;qe(o),y("status",Re(o)[0]||"todo"),nt(o)},sx:{minWidth:180,"& .MuiOutlinedInput-notchedOutline":{borderColor:e=>m.chipBorder(e)}},children:[t.jsx(p,{value:a.KANBAN,children:"Kanban"}),t.jsx(p,{value:a.SCRUM,children:"Scrum"}),t.jsx(p,{value:a.AGILE,children:"Agile"}),t.jsx(p,{value:a.WATERFALL,children:"Waterfall"}),t.jsx(p,{value:a.LEAN,children:"Lean"})]}),t.jsx(q,{size:"small",label:Oe,sx:{fontWeight:700,height:22,background:e=>m.chipBg(e),border:e=>`1px solid ${m.chipBorder(e)}`}})]}),t.jsxs(w,{direction:"row",alignItems:"center",spacing:2,sx:{mb:2},children:[t.jsx(I,{size:"small",placeholder:"Search tasks by name or description...",value:T,onChange:e=>le(e.target.value),sx:{flexGrow:1,maxWidth:400,"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"},"&.Mui-focused":{backgroundColor:"rgba(255, 255, 255, 1)"}},"& .MuiOutlinedInput-notchedOutline":{borderColor:e=>m.chipBorder(e)}},InputProps:{startAdornment:t.jsx(_e,{position:"start",children:t.jsx(Et,{sx:{color:"text.secondary"}})}),endAdornment:T&&t.jsx(_e,{position:"end",children:t.jsx(ge,{size:"small",onClick:()=>le(""),sx:{color:"text.secondary"},children:t.jsx($t,{fontSize:"small"})})})}}),t.jsxs(Ht,{size:"small",sx:{minWidth:140},children:[t.jsx(Pt,{children:"Priority Filter"}),t.jsxs(Wt,{value:B,onChange:e=>je(e.target.value),label:"Priority Filter",sx:{borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"},"&.Mui-focused":{backgroundColor:"rgba(255, 255, 255, 1)"},"& .MuiOutlinedInput-notchedOutline":{borderColor:e=>m.chipBorder(e)}},startAdornment:t.jsx(qt,{sx:{color:"text.secondary",mr:1}}),children:[t.jsx(p,{value:"",children:"All Priorities"}),t.jsx(p,{value:"low",children:"Low"}),t.jsx(p,{value:"medium",children:"Medium"}),t.jsx(p,{value:"high",children:"High"}),t.jsx(p,{value:"urgent",children:"Urgent"})]})]}),(T||B)&&t.jsx(O,{size:"small",variant:"outlined",onClick:()=>{le(""),je("")},sx:{borderRadius:2,textTransform:"none",backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"},borderColor:e=>m.chipBorder(e)},children:"Clear Filters"})]}),t.jsx(pt,{}),t.jsx(Ct,{onDragEnd:mt,children:t.jsx(N,{sx:{display:"flex",flexDirection:"row",alignItems:"stretch",gap:"var(--col-gap)",pb:3,overflowX:"auto",overflowY:"hidden",scrollSnapType:"x proximity","&::-webkit-scrollbar":{height:8},"&::-webkit-scrollbar-thumb":{background:u("#000",.2),borderRadius:8}},children:c.map(e=>t.jsx(wt,{statusKey:e,tasks:P[e]||[],onAddTask:ue,statusMeta:Q,project:r,showProjectSummary:!1,renderTaskCard:(o,s)=>t.jsx(N,{sx:{transition:"transform .18s, box-shadow .22s",transform:s.isDragging?"rotate(1.5deg) scale(1.02)":"none",boxShadow:s.isDragging?`0 8px 20px -6px ${u(Q[e]?.accent||m.accent,.45)}`:"0 1px 3px rgba(0,0,0,.12)",borderRadius:2},children:t.jsx(Ot,{task:o,onEdit:()=>it(o),onDelete:()=>Me(o.id),onImageUpload:i=>ct(o,i),onClick:()=>{k.visit(`/projects/${r.id}/tasks/${o.id}`)},accent:Q[e]?.accent||m.accent})})},e))})},l),t.jsx(Xt,{onAddTask:()=>{ue(c[0]),setTimeout(()=>Te.current?.focus(),60)},onOpenAssistant:()=>ce(!0),methodStyles:m,assistantOpen:X,projectId:r.id}),t.jsx(Be,{open:ne,onClose:()=>z(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,overflow:"hidden",background:"linear-gradient(140deg,rgba(255,255,255,0.95),rgba(255,255,255,0.8))",backdropFilter:"blur(12px)",border:e=>`1px solid ${m.chipBorder(e)}`}},children:t.jsxs("form",{onSubmit:at,children:[t.jsxs(We,{sx:{fontWeight:700,pr:6,display:"flex",alignItems:"center",gap:1},children:[j?"Edit Task":"Create Task",t.jsx(q,{size:"small",label:j?"Editing":"New",sx:{fontWeight:700,height:22,bgcolor:j?"#ffc107":"#17a2b8",color:j?"#212529":"#ffffff",border:"none",fontSize:"0.75rem","& .MuiChip-label":{fontWeight:700,color:j?"#212529":"#ffffff",px:1}}}),t.jsx(ge,{size:"small","aria-label":"Close",onClick:()=>z(!1),sx:{ml:"auto"},children:t.jsx(vt,{fontSize:"small"})})]}),t.jsxs(Pe,{dividers:!0,sx:{display:"flex",flexDirection:"column",gap:1.5,pt:2,maxHeight:"60vh",overflowY:"auto"},children:[t.jsx(I,{label:"Title",required:!0,fullWidth:!0,inputRef:Te,value:C.title,onChange:e=>y("title",e.target.value),error:!!f.title,helperText:f.title,placeholder:"Concise task name",variant:"outlined",size:"small"}),t.jsx(I,{label:"Description",multiline:!0,minRows:3,fullWidth:!0,value:C.description,onChange:e=>y("description",e.target.value),error:!!f.description,helperText:f.description||"Add optional context, acceptance criteria, etc.",placeholder:"Add more context...",size:"small"}),t.jsxs(w,{direction:{xs:"column",sm:"row"},spacing:1,children:[t.jsx(I,{label:"Start Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:C.start_date,onChange:e=>y("start_date",e.target.value),error:!!f.start_date,helperText:f.start_date||"Optional",size:"small",InputProps:{startAdornment:t.jsx(he,{fontSize:"small",sx:{mr:1,color:"text.disabled"}})}}),t.jsx(I,{label:"Due / Execution Date",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:C.end_date,onChange:e=>y("end_date",e.target.value),error:!!f.end_date,helperText:f.end_date||"Optional",size:"small",InputProps:{startAdornment:t.jsx(he,{fontSize:"small",sx:{mr:1,color:"text.disabled"}})}}),t.jsxs(I,{select:!0,label:"Assign To",fullWidth:!0,value:C.assignee_id,onChange:e=>y("assignee_id",e.target.value),error:!!f.assignee_id,helperText:f.assignee_id||"Optional",size:"small",InputProps:{startAdornment:t.jsx(jt,{fontSize:"small",sx:{mr:1,color:"text.disabled"}})},children:[t.jsx(p,{value:"",children:"— Unassigned —"}),Array.isArray(M)&&M.map(e=>t.jsx(p,{value:e.id,children:e.name},e.id))]})]}),t.jsxs(w,{direction:{xs:"column",sm:"row"},spacing:1,children:[t.jsxs(I,{select:!0,label:"Priority",fullWidth:!0,value:C.priority,onChange:e=>y("priority",e.target.value),error:!!f.priority,helperText:f.priority||"Task priority level",size:"small",children:[t.jsx(p,{value:"low",children:"Low"}),t.jsx(p,{value:"medium",children:"Medium"}),t.jsx(p,{value:"high",children:"High"}),t.jsx(p,{value:"urgent",children:"Urgent"})]}),t.jsxs(I,{select:!0,label:"Milestone",fullWidth:!0,value:String(C.milestone),onChange:e=>y("milestone",e.target.value==="true"),error:!!f.milestone,helperText:f.milestone||"Mark as project milestone",size:"small",InputProps:{startAdornment:t.jsx(Le,{fontSize:"small",sx:{mr:1,color:"text.disabled"}})},children:[t.jsx(p,{value:"false",children:"Regular Task"}),t.jsx(p,{value:"true",children:"Milestone"})]})]}),j&&t.jsxs(N,{sx:{p:2,border:"1px dashed",borderColor:"divider",borderRadius:2,backgroundColor:"rgba(0,0,0,0.02)"},children:[t.jsx(H,{variant:"subtitle2",sx:{mb:1,fontWeight:600,fontSize:"0.875rem"},children:"Task Images"}),t.jsxs(O,{variant:"outlined",component:"label",size:"small",disabled:ve,sx:{mb:1},children:[ve?"Uploading...":"Add Image",t.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:dt})]}),S&&D&&(()=>{let e=null;return Object.values(S).forEach(o=>{const s=o.find(i=>i.id===D);s&&(e=s)}),e?.attachments_count>0?t.jsxs(H,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:[e.attachments_count," image",e.attachments_count!==1?"s":""," ","attached"]}):null})()]}),t.jsx(I,{select:!0,label:"Status",fullWidth:!0,value:C.status,onChange:e=>y("status",e.target.value),helperText:"Choose where it should appear on the board.",size:"small",children:c.map(e=>t.jsx(p,{value:e,children:Q[e]?.title||e},e))})]}),t.jsxs(He,{sx:{px:2,py:1.5},children:[t.jsx(O,{onClick:()=>z(!1),disabled:$,children:"Cancel"}),j&&t.jsx(L,{title:"Delete task",children:t.jsx(ge,{color:"error",onClick:()=>{z(!1),Me(D)},size:"small",sx:{mr:"auto"},children:t.jsx(Vt,{})})}),t.jsx(O,{type:"submit",variant:"contained",disabled:$,sx:{textTransform:"none",fontWeight:700,px:2.2,py:.6,background:m.accent,boxShadow:"0 6px 16px -8px rgba(0,0,0,.28)","&:hover":{opacity:.95}},children:$?j?"Updating…":"Creating…":j?"Update Task":"Create Task"})]})]})}),t.jsxs(Be,{open:Ye,onClose:()=>{Y(!1),Z(null)},maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:e=>`linear-gradient(140deg, ${u(e.palette.error.light,.15)}, #fff)`,border:e=>`1px solid ${u(e.palette.error.main,.35)}`,backdropFilter:"blur(10px)"}},children:[t.jsx(We,{sx:{fontWeight:800,pr:6},children:"Delete Task"}),t.jsx(Pe,{dividers:!0,sx:{display:"flex",flexDirection:"column",gap:1},children:t.jsxs(H,{variant:"body2",children:["Are you sure you want to permanently delete",Ee?' "'+Ee.title+'"':" this task","? This action cannot be undone."]})}),t.jsxs(He,{sx:{px:2,py:1.25},children:[t.jsx(O,{onClick:()=>{Y(!1),Z(null)},children:"Cancel"}),t.jsx(O,{onClick:lt,color:"error",variant:"contained",sx:{fontWeight:700,textTransform:"none"},children:"Delete"})]})]}),t.jsx(Lt,{open:Ke,onClose:()=>Se(!1),project:r,members:Array.isArray(M)?M:[]}),t.jsx(Rt,{open:ye,onClose:()=>Ce(!1),project:r,tasks:S,users:M},ye?"open":"closed"),t.jsx(Mt,{open:Ze,onClose:()=>we(!1)}),t.jsx(_t,{open:Xe,onClose:()=>Ae(!1),project:r}),t.jsx(Bt,{project:r,open:X,onClose:()=>ce(!1)})]})})]})}export{_r as default};
