import{j as r}from"./index-BgEJ3fxA.js";import{r as u}from"./ProjectReportDialog-DJSS4N_t.js";import{B as s}from"./Box-DwDErR6p.js";import{T as E}from"./Tooltip-B2fzUN7_.js";import{L as z}from"./LinearProgress-DS1Mq4qD.js";import{T as v}from"./Typography-D7k_4FBJ.js";import{a as d}from"./createTheme-C_kE-Qd2.js";import"./DefaultPropsProvider-Bua-nAaA.js";import"./index-Cvm9KgRT.js";import"./useSlot-CiX-lWvG.js";import"./useControlled-LNSG5UB_.js";import"./getReactElementRef-F5A8c8Er.js";import"./index-CaqUbZRR.js";import"./Grow---KOMtVK.js";import"./Portal-DfkSyL9i.js";import"./useSlotProps-5DvMlV7h.js";import"./isFocusVisible-B8k4qzLc.js";const L=e=>e instanceof Date?e:e?new Date(`${String(e)}T00:00:00`):null;function Z({task:e,pxPerDay:m,rowHeight:x=44,accent:p="#4F46E5",scale:l,onChangeDates:R}){const h=u.useMemo(()=>L(e.start_date||e.end_date||new Date),[e.start_date,e.end_date]),g=u.useMemo(()=>L(e.end_date||e.start_date||new Date),[e.end_date,e.start_date]),D=Math.max(m*.9,12),[j,c]=u.useState(null),_=u.useRef(null);l(h),l(g);const f=(o,t)=>{t.preventDefault(),t.stopPropagation(),c({mode:o,x0:t.clientX,s0:h,e0:g}),window.addEventListener("mousemove",M),window.addEventListener("mouseup",$,{once:!0})},M=o=>{c(t=>{if(!t)return t;const a=Math.round((o.clientX-t.x0)/m);let i=t.s0,n=t.e0;return t.mode==="move"?(i=new Date(t.s0),i.setDate(i.getDate()+a),n=new Date(t.e0),n.setDate(n.getDate()+a)):t.mode==="left"?(i=new Date(t.s0),i.setDate(i.getDate()+a),n<i&&(n=new Date(i))):(n=new Date(t.e0),n.setDate(n.getDate()+a),n<i&&(i=new Date(n))),{...t,previewS:i,previewE:n}})},$=()=>{window.removeEventListener("mousemove",M),c(o=>{if(!o)return null;const t=o.previewS||o.s0,a=o.previewE||o.e0;return R?.(e.id,t,a),null})},w=j?.previewS||h,b=j?.previewE||g,S=l(w),T=l(b),W=Math.max(D,T-S||D),y=!!e.milestone;return r.jsx(s,{sx:{position:"relative",height:x},children:y?r.jsx(E,{title:e.title,children:r.jsx(s,{sx:{position:"absolute",top:(x-14)/2,left:l(b||w)+m/2-7,width:14,height:14,transform:"rotate(45deg)",background:`linear-gradient(145deg, ${d(p,.9)}, ${p})`,boxShadow:"0 2px 6px rgba(0,0,0,.25)"}})}):r.jsx(E,{title:r.jsxs(s,{sx:{p:.5},children:[r.jsx(v,{variant:"caption",sx:{fontWeight:700},children:e.title}),r.jsxs(v,{variant:"caption",display:"block",children:[w.toLocaleDateString()," â€” ",b.toLocaleDateString()]})]}),children:r.jsxs(s,{ref:_,onMouseDown:o=>f("move",o),sx:{position:"absolute",top:(x-22)/2,left:S,width:W,height:22,borderRadius:11,background:`linear-gradient(145deg, ${d(p,.85)}, ${p})`,boxShadow:`0 10px 24px -12px ${d(p,.65)}`,cursor:"grab",overflow:"hidden"},children:[typeof e.progress=="number"&&r.jsx(z,{variant:"determinate",value:Math.max(0,Math.min(100,Number(e.progress))),sx:{height:"100%",background:d("#000",.12),"& .MuiLinearProgress-bar":{background:"#fff",opacity:.45}}}),m>=20&&r.jsx(v,{variant:"caption",sx:{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",fontWeight:700,color:"rgba(0,0,0,0.75)",textShadow:"0 1px 2px rgba(255,255,255,.7)",whiteSpace:"nowrap",maxWidth:"90%",overflow:"hidden",textOverflow:"ellipsis"},children:e.title}),r.jsx(s,{onMouseDown:o=>f("left",o),sx:{position:"absolute",left:-6,top:-2,width:8,height:26,borderRadius:2,background:d("#000",.18),cursor:"ew-resize"}}),r.jsx(s,{onMouseDown:o=>f("right",o),sx:{position:"absolute",right:-6,top:-2,width:8,height:26,borderRadius:2,background:d("#000",.18),cursor:"ew-resize"}})]})})})}export{Z as default};
