import{j as e}from"./index-BgEJ3fxA.js";import{r as m}from"./ProjectReportDialog-DJSS4N_t.js";import{H as st,r as P}from"./app-K9NsoLMf.js";import{A as it}from"./ArrowBack-BADPg0TL.js";import{C as at}from"./CalendarMonthRounded-D2pw7wm1.js";import{c as G}from"./createSvgIcon-BJOZcqxU.js";import{u as lt,T as w}from"./Typography-D7k_4FBJ.js";import{B as a}from"./Box-DwDErR6p.js";import{P as K}from"./Paper-PFfIOqkm.js";import{T as y}from"./Tooltip-B2fzUN7_.js";import{I}from"./IconButton-MFFsjt5V.js";import{C as T}from"./Chip-21CA6oxg.js";import{D as dt}from"./Divider-Mh942rqT.js";import{S as L}from"./Stack-8UQV77y9.js";import{B as ct}from"./Button-awGqnw0r.js";import{a as o}from"./createTheme-C_kE-Qd2.js";import"./DefaultPropsProvider-Bua-nAaA.js";import"./index-Cvm9KgRT.js";import"./useSlot-CiX-lWvG.js";import"./useControlled-LNSG5UB_.js";import"./getReactElementRef-F5A8c8Er.js";import"./index-CaqUbZRR.js";import"./Grow---KOMtVK.js";import"./Portal-DfkSyL9i.js";import"./useSlotProps-5DvMlV7h.js";import"./isFocusVisible-B8k4qzLc.js";import"./ButtonBase-Cf3WRSsW.js";import"./CircularProgress-RchlJGKc.js";import"./dividerClasses-C37mlFxW.js";import"./useThemeProps-BWPYVe8w.js";const pt=G(e.jsx("path",{d:"M19 3h-1V2c0-.55-.45-1-1-1s-1 .45-1 1v1H8V2c0-.55-.45-1-1-1s-1 .45-1 1v1H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-1 16H6c-.55 0-1-.45-1-1V8h14v10c0 .55-.45 1-1 1M8 10h3c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1H8c-.55 0-1-.45-1-1v-3c0-.55.45-1 1-1"})),xt=G(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.78 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.26 4.25c.41.41 1.07.41 1.48 0l.01-.01c.41-.41.41-1.07 0-1.48zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14m0-7c-.28 0-.5.22-.5.5V9H7.5c-.28 0-.5.22-.5.5s.22.5.5.5H9v1.5c0 .28.22.5.5.5s.5-.22.5-.5V10h1.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H10V7.5c0-.28-.22-.5-.5-.5"})),mt=G(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.26 4.25c.41.41 1.07.41 1.48 0l.01-.01c.41-.41.41-1.07 0-1.48zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14m-2-5h4c.28 0 .5.22.5.5s-.22.5-.5.5h-4c-.28 0-.5-.22-.5-.5s.22-.5.5-.5"})),S=n=>{if(!n)return null;try{if(n instanceof Date)return new Date(n);if(typeof n=="string"){let p=n.trim();if(p.includes(" ")&&(p=p.split(" ")[0]),p.includes("T")&&(p=p.split("T")[0]),/^\d{4}-\d{2}-\d{2}$/.test(p)){const[x,F,j]=p.split("-").map(Number);return new Date(x,F-1,j)}}const c=new Date(n);return isNaN(c.getTime())?null:c}catch{return null}},R=(n,c)=>{if(!n||!c)return 0;const p=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime(),x=new Date(c.getFullYear(),c.getMonth(),c.getDate()).getTime();return Math.floor((x-p)/(1440*60*1e3))},B=(n,c)=>{const p=new Date(n);return p.setDate(p.getDate()+c),p},Y=n=>new Date(n.getFullYear(),n.getMonth(),1),W=n=>new Date(n.getFullYear(),n.getMonth()+1,0),ht=n=>n.toLocaleDateString(void 0,{month:"short",year:"numeric"}),D=n=>n.toLocaleDateString(void 0,{month:"short",day:"numeric"}),O=260,E=44,z=56,U=18,ut=36,N=8,V=42,u={todo:"#64748B",inprogress:"#0EA5E9",review:"#8B5CF6",done:"#10B981"};function Gt({project:n={},tasks:c={},users:p=[]}){const x=lt(),F=m.useMemo(()=>{const t=[];return!c||typeof c!="object"||["todo","inprogress","review","done"].forEach(r=>{(Array.isArray(c[r])?c[r]:[]).forEach(i=>t.push({...i,status:r}))}),t},[c]),j=m.useMemo(()=>F.map(t=>{const r=S(t.start_date),s=S(t.end_date);let i=r||s||new Date,d=s||r||i;d<i&&(d=new Date(i));const b=Math.max(1,R(i,d)+1),v=!!s;return{...t,_start:i,_end:d,_days:b,_isMilestone:!!t.milestone,_hasEndDate:v}}),[F]),l=m.useMemo(()=>{const t=[];j.forEach(h=>{h._start&&t.push(h._start),h._end&&t.push(h._end)});const r=S(n?.start_date),s=S(n?.end_date);if(r&&t.push(r),s&&t.push(s),t.length===0){const h=new Date;return{start:Y(h),end:W(B(h,30))}}const i=new Date(Math.min(...t.map(h=>h.getTime()))),d=new Date(Math.max(...t.map(h=>h.getTime()))),b=Y(B(i,-5)),v=W(B(d,5));return{start:b,end:v}},[j,n]),$=R(l.start,l.end)+1,M=m.useRef(null),H=m.useRef(null),[f,k]=m.useState(14),A=m.useCallback(()=>{if(!M.current)return;const t=M.current.clientWidth,r=Math.max(800,t-O-48),s=Math.max(N,Math.min(V,Math.floor(r/$)));k(s)},[$]);m.useEffect(()=>{const t=new ResizeObserver(A);return M.current&&t.observe(M.current),A(),()=>t.disconnect()},[A]);const q=()=>k(t=>Math.min(V,t+2)),J=()=>k(t=>Math.max(N,t-2)),_=t=>t?R(l.start,t)*f:0,Q=m.useMemo(()=>{const t=[];let r=Y(l.start);for(;r<=l.end;){const s=r<l.start?l.start:r,i=W(r)>l.end?l.end:W(r);t.push({start:new Date(s),end:new Date(i),label:ht(r)}),r=new Date(r.getFullYear(),r.getMonth()+1,1)}return t},[l]),tt=m.useMemo(()=>{const t=[],r=$;for(let s=0;s<=r;s++){const i=B(l.start,s);(i.getDay()===1||s===0)&&t.push({dayOffset:s,date:i})}return t},[l,$]),g=m.useMemo(()=>[...j].sort((r,s)=>r._start.getTime()-s._start.getTime()||r.title.localeCompare(s.title)),[j]),et=`${D(l.start)} — ${D(l.end)}`,rt=m.useMemo(()=>g.filter(t=>t._hasEndDate).length,[g]),X=m.useMemo(()=>g.filter(t=>!t._hasEndDate).length,[g]),C=new Date,Z=C>=new Date(l.start.getFullYear(),l.start.getMonth(),l.start.getDate())&&C<=new Date(l.end.getFullYear(),l.end.getMonth(),l.end.getDate()),ot=()=>{if(!H.current)return;const t=_(C);H.current.scrollTo({left:Math.max(0,t-240),behavior:"smooth"})},nt=g.length===0;return e.jsxs(e.Fragment,{children:[e.jsx(st,{title:`${n?.name??"Project"} — Timeline`}),e.jsxs(a,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",background:x.palette.mode==="light"?"linear-gradient(135deg,#F6FAFF,#EEF2F7)":"linear-gradient(135deg,#0B1220,#0E1726)"},children:[e.jsxs(K,{elevation:0,sx:{px:{xs:1.5,md:3},py:1.25,display:"flex",alignItems:"center",gap:1.25,borderBottom:t=>`1px solid ${o(t.palette.divider,.8)}`,borderRadius:0,background:x.palette.mode==="light"?"linear-gradient(180deg,rgba(255,255,255,0.96),rgba(255,255,255,0.86))":o("#0F172A",.7),backdropFilter:"blur(8px)",position:"sticky",top:0,zIndex:20},children:[e.jsx(y,{title:"Back to Board",children:e.jsx(I,{onClick:()=>P.visit(route("tasks.index",n.id)),sx:{color:t=>o(t.palette.text.primary,.7),border:t=>`1px solid ${o(t.palette.text.primary,.15)}`},size:"small",children:e.jsx(it,{})})}),e.jsx(w,{variant:"h6",sx:{fontWeight:800,letterSpacing:.2,mr:.5,background:x.palette.mode==="light"?"linear-gradient(90deg,#0F1F47,#2E4B7F)":"linear-gradient(90deg,#C8D7FF,#9EC2FF)",WebkitBackgroundClip:"text",color:"transparent"},children:n?.name||"Project Timeline"}),e.jsx(T,{icon:e.jsx(at,{}),label:et,size:"small",sx:{height:24,"& .MuiChip-icon":{fontSize:18},fontWeight:700,background:t=>o(t.palette.primary.main,.08),border:t=>`1px solid ${o(t.palette.primary.main,.22)}`}}),e.jsx(dt,{flexItem:!0,orientation:"vertical",sx:{mx:1}}),e.jsxs(L,{direction:"row",spacing:.75,alignItems:"center",flexWrap:"wrap",children:[e.jsx(T,{size:"small",label:`Total ${g.length}`,sx:{height:24,fontWeight:700,background:t=>o(t.palette.text.primary,.06),border:t=>`1px solid ${o(t.palette.text.primary,.12)}`}}),e.jsx(T,{size:"small",label:`${rt} scheduled`,sx:{height:24,fontWeight:700,background:o(u.done,.12),border:`1px solid ${o(u.done,.28)}`}}),X>0&&e.jsx(T,{size:"small",label:`${X} missing due date`,sx:{height:24,fontWeight:700,background:o("#DC2626",.12),border:`1px solid ${o("#DC2626",.28)}`}})]}),e.jsx(a,{sx:{flexGrow:1}}),e.jsxs(L,{direction:"row",alignItems:"center",spacing:.5,children:[e.jsx(y,{title:"Zoom out",children:e.jsx("span",{children:e.jsx(I,{onClick:J,disabled:f<=N,size:"small",sx:{color:t=>o(t.palette.text.primary,.7)},children:e.jsx(mt,{})})})}),e.jsxs(w,{variant:"caption",sx:{minWidth:64,textAlign:"center",opacity:.7},children:[f,"px/day"]}),e.jsx(y,{title:"Zoom in",children:e.jsx("span",{children:e.jsx(I,{onClick:q,disabled:f>=V,size:"small",sx:{color:t=>o(t.palette.text.primary,.7)},children:e.jsx(xt,{})})})}),Z&&e.jsx(y,{title:"Scroll to today",children:e.jsx(I,{onClick:ot,size:"small",sx:{color:"#DC2626",border:t=>`1px solid ${o("#DC2626",.35)}`,ml:.5},children:e.jsx(pt,{})})})]})]}),e.jsx(a,{sx:{px:{xs:1.5,md:3},pt:1,pb:.5},children:e.jsx(L,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[["To do",u.todo],["In progress",u.inprogress],["Review",u.review],["Done",u.done]].map(([t,r])=>e.jsx(T,{size:"small",label:t,sx:{height:22,fontWeight:700,background:o(r,.12),border:`1px solid ${o(r,.32)}`,"& .MuiChip-label":{px:1}}},t))})}),e.jsx(a,{ref:M,sx:{flex:1,display:"flex",overflow:"hidden",p:{xs:1.25,md:2}},children:e.jsxs(K,{elevation:0,sx:{flex:1,display:"flex",overflow:"hidden",borderRadius:3,border:t=>`1px solid ${o(t.palette.primary.main,.15)}`,background:x.palette.mode==="light"?"linear-gradient(145deg,rgba(255,255,255,.96),rgba(255,255,255,.86))":o("#0B1220",.6),backdropFilter:"blur(10px)"},children:[e.jsxs(a,{sx:{width:O,minWidth:O,borderRight:t=>`1px solid ${o(t.palette.divider,.8)}`,display:"flex",flexDirection:"column"},children:[e.jsx(a,{sx:{height:z,display:"flex",alignItems:"center",px:2,fontWeight:800,letterSpacing:.4,color:t=>o(t.palette.text.primary,.9),background:t=>x.palette.mode==="light"?o(t.palette.primary.main,.05):o(t.palette.primary.main,.12),borderBottom:t=>`1px solid ${o(t.palette.divider,.8)}`},children:"TASKS"}),nt?e.jsxs(a,{sx:{p:3,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(w,{variant:"body2",sx:{opacity:.8},children:"No tasks to display on the timeline."}),e.jsx(ct,{variant:"outlined",size:"small",onClick:()=>P.visit(route("tasks.index",n.id)),sx:{textTransform:"none",alignSelf:"start"},children:"Go to Board"})]}):e.jsx(a,{sx:{position:"relative",flex:1,overflow:"hidden"},children:g.map((t,r)=>e.jsxs(a,{sx:{height:E,px:2,display:"flex",alignItems:"center",borderBottom:s=>`1px solid ${o(s.palette.divider,.5)}`,background:r%2===0?o(x.palette.background.paper,.45):"transparent"},children:[e.jsx(a,{sx:{width:10,height:10,borderRadius:"50%",backgroundColor:u[t.status]||u.todo,mr:1,flexShrink:0}}),e.jsx(y,{title:t._hasEndDate?`${t.title} • ${D(t._start)} → ${D(t._end)} • ${t._days} day${t._days>1?"s":""}`:`${t.title} • Missing due date`,arrow:!0,children:e.jsxs(w,{variant:"body2",noWrap:!0,sx:{fontWeight:600,color:t._hasEndDate?void 0:"#DC2626"},children:[t.title,!t._hasEndDate&&e.jsx("span",{style:{marginLeft:6},children:"⚠️"})]})})]},t.id))})]}),e.jsxs(a,{ref:H,sx:{position:"relative",flex:1,overflow:"auto"},children:[e.jsx(a,{sx:{position:"sticky",top:0,zIndex:5,height:z,background:x.palette.mode==="light"?o("#FFFFFF",.9):o("#0B1220",.8),backdropFilter:"blur(6px)",borderBottom:t=>`1px solid ${o(t.palette.divider,.8)}`},children:e.jsx(a,{sx:{position:"relative",height:"100%"},children:Q.map((t,r)=>{const s=_(t.start),i=(R(t.start,t.end)+1)*f;return e.jsx(a,{sx:{position:"absolute",left:s,width:i,height:"100%",display:"flex",alignItems:"center",pl:1,borderRight:d=>`1px solid ${o(d.palette.divider,.6)}`,background:r%2===0?o(x.palette.primary.main,.02):"transparent"},children:e.jsx(w,{variant:"body2",sx:{fontWeight:800,letterSpacing:.3,color:d=>o(d.palette.text.primary,.9),textTransform:"uppercase",fontSize:12},children:t.label})},`${t.label}-${r}`)})})}),e.jsxs(a,{sx:{position:"relative",minWidth:$*f},children:[tt.map((t,r)=>{const s=t.dayOffset*f,i=t.dayOffset===0;return e.jsx(a,{sx:{position:"absolute",top:0,bottom:0,left:s,width:0,borderLeft:d=>`${i?2:1}px dashed ${i?o(d.palette.primary.main,.5):o(d.palette.divider,.5)}`,pointerEvents:"none"}},`week-${r}`)}),Z&&e.jsx(a,{sx:{position:"absolute",top:0,bottom:0,left:_(C),width:0,borderLeft:`2px solid ${o("#DC2626",.9)}`,zIndex:4,pointerEvents:"none"}}),g.map((t,r)=>e.jsx(a,{sx:{position:"absolute",left:0,right:0,top:z+r*E,height:E,background:r%2===0?o(x.palette.primary.main,.015):"transparent"}},`bg-${t.id}`)),e.jsx(a,{sx:{position:"relative",mt:`${z}px`},children:g.map((t,r)=>{const s=_(t._start),i=Math.max(ut,t._days*f),d=r*E+(E-U)/2;if(t._isMilestone){const v=_(t._end)-8;return e.jsx(y,{title:`${t.title} (Milestone) — ${D(t._end)}`,arrow:!0,children:e.jsx(a,{sx:{position:"absolute",left:v,top:d,width:16,height:16,transform:"rotate(45deg)",background:"#DC2626",border:"2px solid #fff",boxShadow:"0 4px 12px rgba(220,38,38,0.35)",cursor:"default"}})},t.id)}const b=u[t.status]||u.todo;return e.jsx(y,{arrow:!0,title:`${t.title} • ${D(t._start)} → ${D(t._end)} • ${t._days} day${t._days>1?"s":""} • ${t.status}`,children:e.jsx(a,{onDoubleClick:()=>P.visit(route("tasks.index",n.id)),sx:{position:"absolute",left:s,top:d,width:i,height:U,background:`linear-gradient(90deg, ${o(b,.95)}, ${o(b,.82)})`,borderRadius:10,border:v=>`1px solid ${o("#000",.08)}`,boxShadow:`0 6px 16px ${o(b,.38)}`,cursor:"pointer",transition:"transform .18s ease, box-shadow .18s ease","&:hover":{transform:"translateY(-2px)",boxShadow:`0 10px 24px ${o(b,.5)}`}}})},t.id)})})]})]})]})}),e.jsx(a,{sx:{px:{xs:1.5,md:3},pb:2,pt:.5,opacity:.7},children:e.jsx(w,{variant:"caption",children:"Tip: Use the Zoom controls to change scale. Double-click a bar to jump back to the board."})})]})]})}export{Gt as default};
