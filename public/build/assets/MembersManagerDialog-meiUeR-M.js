import{j as e}from"./index-BgEJ3fxA.js";import{r as m}from"./ProjectReportDialog-DJSS4N_t.js";import"./app-K9NsoLMf.js";import{D as se,a as re}from"./DialogContent-DSMMXfBC.js";import{D as ie}from"./DialogTitle-CslrqFxR.js";import{B as n}from"./Box-DwDErR6p.js";import{P as ne}from"./Person-CwYP7FD8.js";import{A as z}from"./Alert-AqF1eoq9.js";import{T as a}from"./Typography-D7k_4FBJ.js";import{T as ae,I as oe,S as le}from"./TextField-BZLKsJ9m.js";import{a as ce}from"./FormControl-9Ne_wXge.js";import{M as A}from"./MenuItem-CFfd6fkg.js";import{B as W}from"./Button-awGqnw0r.js";import{C as de}from"./CircularProgress-RchlJGKc.js";import{c as f}from"./createSvgIcon-BJOZcqxU.js";import{D as R}from"./Divider-Mh942rqT.js";import{L}from"./List-D9XOj4nK.js";import{L as O}from"./ListItem-U-GawdQ1.js";import{A as V}from"./Avatar-B0qmhRz_.js";import{C as u}from"./Chip-21CA6oxg.js";import{I as $}from"./IconButton-MFFsjt5V.js";import{D as me}from"./Delete-hxgZVV99.js";import{E as xe}from"./Email-lTpUEqYc.js";import{D as ue}from"./DialogActions-tu8p45QK.js";import{V as F}from"./Visibility-DofpzXGt.js";import{E as H}from"./Edit-KFQoxZFW.js";import{S as _}from"./Settings-BkChhv5Z.js";import{G as q}from"./Group-v2Nq1Fc-.js";import{S as X}from"./Security-CZEkmB0V.js";import{T as B}from"./Tooltip-B2fzUN7_.js";import"./DefaultPropsProvider-Bua-nAaA.js";import"./createTheme-C_kE-Qd2.js";import"./useSlot-CiX-lWvG.js";import"./Paper-PFfIOqkm.js";import"./Fade-DhaX7TN9.js";import"./getReactElementRef-F5A8c8Er.js";import"./index-CaqUbZRR.js";import"./Modal-DIrGbC0Y.js";import"./ownerWindow-XbzhRCTS.js";import"./Portal-DfkSyL9i.js";import"./debounce-Be36O1Ab.js";import"./index-Cvm9KgRT.js";import"./useSlotProps-5DvMlV7h.js";import"./Grow---KOMtVK.js";import"./useControlled-LNSG5UB_.js";import"./isMuiElement-BEUJm6md.js";import"./ButtonBase-Cf3WRSsW.js";import"./isFocusVisible-B8k4qzLc.js";import"./listItemTextClasses-DfQra0jB.js";import"./dividerClasses-C37mlFxW.js";const he=f(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),pe=f(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M7 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m5 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),fe=f(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),N=f(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm-3.06 16L7.4 14.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41zM13 9V3.5L18.5 9z"})),ut=({open:j,onClose:k,project:o})=>{const[p,T]=m.useState(""),[b,M]=m.useState("member"),[g,y]=m.useState([]),[v,w]=m.useState([]),[x,c]=m.useState(!1),[E,d]=m.useState(""),[C,h]=m.useState(""),I=t=>{if(!t)return null;const r=[t.user_id,t.owner_id,t.ownerId,t.created_by,t.createdBy,t.user?.id,t.owner?.id].find(i=>i!=null);return r===void 0?null:r},P=t=>{if(!t)return null;const r=[t.id,t.user_id,t.userId,t.user?.id].find(i=>i!=null);return r===void 0?null:r},D=o&&I(o)!=null?String(I(o)):null,J=(t,s)=>t==null||s==null?!1:String(t)===String(s);m.useEffect(()=>{j&&o?.id&&G()},[j,o?.id]);const G=async()=>{try{c(!0);const t=await fetch(`/projects/${o.id}/members`,{method:"GET",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();y(s.members||[]),w(s.invitations||[])}catch(t){d("Failed to load members: "+t.message),console.error("Error loading members:",t)}finally{c(!1)}},K=async t=>{if(t.preventDefault(),!!p.trim())try{c(!0),d(""),h("");const s=await fetch(`/projects/${o.id}/members/invite`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({email:p.trim(),role:b})});if(!s.ok){const i=await s.json();throw new Error(i.error||`HTTP error! status: ${s.status}`)}const r=await s.json();r.type==="direct_add"?(h(`${r.user.name} has been added to the project!`),y(i=>[...i,{id:r.user.id,name:r.user.name,email:r.user.email,pivot:{role:b,joined_at:new Date().toISOString()}}])):(h(`Invitation sent to ${p}!`),w(i=>[...i,r.invitation])),T(""),M("member")}catch(s){d("Failed to invite member: "+s.message),console.error("Error inviting member:",s)}finally{c(!1)}},U=async t=>{try{c(!0),d("");const s=await fetch(`/projects/${o.id}/members/remove`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({user_id:t})});if(!s.ok){const r=await s.json();throw new Error(r.error||`HTTP error! status: ${s.status}`)}await s.json(),y(r=>r.filter(i=>String(P(i))!==String(t))),h("Member removed successfully")}catch(s){d("Failed to remove member: "+s.message),console.error("Error removing member:",s)}finally{c(!1)}},Q=async t=>{try{c(!0),d("");const s=await fetch(`/projects/${o.id}/members/cancel-invitation`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({invitation_id:t})});if(!s.ok){const r=await s.json();throw new Error(r.error||`HTTP error! status: ${s.status}`)}await s.json(),w(r=>r.filter(i=>String(i.id)!==String(t))),h("Invitation cancelled successfully")}catch(s){d("Failed to cancel invitation: "+s.message),console.error("Error cancelling invitation:",s)}finally{c(!1)}},Y=t=>t==="admin"?"primary":"default",Z=(t,s)=>{const r=t?.pivot?.role||"member";return s?{canViewProject:!0,canViewTasks:!0,canCreateTasks:!0,canEditTasks:!0,canEditProject:!0,canManageMembers:!0,canDeleteProject:!0,role:"owner",isOwner:!0}:{canViewProject:!0,canViewTasks:!0,canCreateTasks:!0,canEditTasks:!0,canEditProject:!1,canManageMembers:!1,canDeleteProject:!1,role:r,isOwner:!1}},ee=({member:t,isOwnerFlag:s})=>{const r=Z(t,s),i=[{key:"viewProject",label:"View Project",icon:e.jsx(F,{}),enabled:r.canViewProject},{key:"viewTasks",label:"View Tasks",icon:e.jsx(N,{}),enabled:r.canViewTasks},{key:"editTasks",label:"Edit Tasks",icon:e.jsx(H,{}),enabled:r.canEditTasks},{key:"editProject",label:"Edit Project",icon:e.jsx(_,{}),enabled:r.canEditProject},{key:"manageMembers",label:"Manage Members",icon:e.jsx(q,{}),enabled:r.canManageMembers}];return e.jsxs(n,{sx:{mt:1},children:[e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,mb:.5,display:"block"},children:[e.jsx(X,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),"Permissions ",r.isOwner?"(Full Access - Owner)":"(Member Access)",":"]}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:i.map(l=>e.jsx(B,{title:l.enabled?`Can ${l.label}`:`Cannot ${l.label}`,children:e.jsx(u,{icon:l.icon,label:l.label,size:"small",variant:l.enabled?"filled":"outlined",color:l.enabled?"success":"default",sx:{fontSize:"0.7rem",height:24,opacity:l.enabled?1:.6,"& .MuiChip-icon":{fontSize:14}}})},l.key))})]})},te=({invitation:t})=>{const s=[{key:"viewProject",label:"View Project",icon:e.jsx(F,{}),enabled:!0},{key:"viewTasks",label:"View Tasks",icon:e.jsx(N,{}),enabled:!0},{key:"editTasks",label:"Edit Tasks",icon:e.jsx(H,{}),enabled:!0},{key:"editProject",label:"Edit Project",icon:e.jsx(_,{}),enabled:!1},{key:"manageMembers",label:"Manage Members",icon:e.jsx(q,{}),enabled:!1}];return e.jsxs(n,{sx:{mt:1},children:[e.jsxs(a,{variant:"caption",color:"warning.main",sx:{fontWeight:600,mb:.5,display:"block"},children:[e.jsx(X,{sx:{fontSize:14,mr:.5,verticalAlign:"middle"}}),"Will have permissions:"]}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>e.jsx(B,{title:r.enabled?`Will be able to ${r.label}`:`Won't be able to ${r.label}`,children:e.jsx(u,{icon:r.icon,label:r.label,size:"small",variant:"outlined",color:r.enabled?"warning":"default",sx:{fontSize:"0.7rem",height:24,opacity:r.enabled?1:.5,"& .MuiChip-icon":{fontSize:14}}})},r.key))})]})},S=t=>new Date(t).toLocaleDateString();return e.jsxs(se,{open:j,onClose:k,maxWidth:"md",fullWidth:!0,children:[e.jsx(ie,{children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ne,{}),"Manage Project Members"]})}),e.jsxs(re,{children:[E&&e.jsx(z,{severity:"error",sx:{mb:2},onClose:()=>d(""),children:E}),C&&e.jsx(z,{severity:"success",sx:{mb:2},onClose:()=>h(""),children:C}),e.jsxs(n,{component:"form",onSubmit:K,sx:{mb:3},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Invite New Member"}),e.jsxs(n,{display:"flex",gap:2,alignItems:"end",children:[e.jsx(ae,{label:"Email Address",type:"email",value:p,onChange:t=>T(t.target.value),fullWidth:!0,disabled:x}),e.jsxs(ce,{sx:{minWidth:120},children:[e.jsx(oe,{children:"Role"}),e.jsxs(le,{value:b,label:"Role",onChange:t=>M(t.target.value),disabled:x,children:[e.jsx(A,{value:"member",children:"Member"}),e.jsx(A,{value:"admin",children:"Admin"})]})]}),e.jsx(W,{type:"submit",variant:"contained",startIcon:x?e.jsx(de,{size:20}):e.jsx(fe,{}),disabled:x||!p.trim(),children:x?"Inviting...":"Invite"})]})]}),e.jsx(R,{sx:{my:2}}),e.jsxs(a,{variant:"h6",gutterBottom:!0,children:["Current Members (",g.length,")"]}),g.length===0?e.jsx(a,{color:"text.secondary",sx:{py:2},children:"No members yet"}):e.jsx(L,{children:g.map(t=>{const s=P(t),r=D!=null&&s!=null&&J(D,s)||t?.pivot?.role==="owner";return e.jsx(O,{sx:{flexDirection:"column",alignItems:"stretch",py:2},children:e.jsxs(n,{sx:{display:"flex",width:"100%",alignItems:"flex-start"},children:[e.jsx(V,{sx:{mr:2,bgcolor:"success.main",mt:.5},children:t.name?.charAt(0)||t.email?.charAt(0)||"U"}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,sx:{mb:1},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600},children:t.name||t.email}),e.jsx(u,{label:t?.pivot?.role||"member",size:"small",color:Y(t?.pivot?.role)}),r&&e.jsx(u,{label:"owner",size:"small",color:"warning"}),e.jsx(u,{label:"Active",size:"small",color:"success",variant:"outlined"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.email}),t?.pivot?.joined_at&&e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:["Joined ",S(t.pivot.joined_at)]}),e.jsx(ee,{member:t,isOwnerFlag:r})]}),e.jsx(n,{sx:{ml:2},children:!r&&e.jsx($,{onClick:()=>U(s),color:"error",disabled:x,size:"small",children:e.jsx(me,{})})})]})},String(s??Math.random()))})}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{my:2}}),e.jsxs(a,{variant:"h6",gutterBottom:!0,children:["Pending Invitations (",v.length,")"]}),e.jsx(L,{children:v.map(t=>e.jsx(O,{sx:{flexDirection:"column",alignItems:"stretch",py:2},children:e.jsxs(n,{sx:{display:"flex",width:"100%",alignItems:"flex-start"},children:[e.jsx(V,{sx:{mr:2,bgcolor:"warning.main",mt:.5},children:e.jsx(xe,{})}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,sx:{mb:1},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600},children:t.email}),e.jsx(u,{icon:e.jsx(pe,{}),label:"Pending Invitation",size:"small",color:"warning",sx:{animation:"pulse 2s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.7},"100%":{opacity:1}}}}),t.role&&e.jsx(u,{label:t.role,size:"small",color:"default",variant:"outlined"})]}),e.jsxs(a,{variant:"caption",color:"warning.main",sx:{fontWeight:500,mb:1,display:"block"},children:["ðŸ“§ Invitation sent"," ",S(t.created_at)," â€¢ â° Expires"," ",S(t.expires_at)]}),e.jsx(te,{invitation:t})]}),e.jsx(n,{sx:{ml:2},children:e.jsx($,{onClick:()=>Q(t.id),color:"error",disabled:x,title:"Cancel invitation",size:"small",children:e.jsx(he,{})})})]})},t.id))})]})]}),e.jsx(ue,{children:e.jsx(W,{onClick:k,children:"Close"})})]})};export{ut as default};
